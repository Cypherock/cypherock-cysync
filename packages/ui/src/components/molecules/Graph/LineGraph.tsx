import { Chart, ChartOptions } from 'chart.js/auto';
import { format as formatDate } from 'date-fns';
import React, { useRef, useEffect } from 'react';

import { Container } from '../../atoms';

export const LineGraph = () => {
  const chartRef = useRef<HTMLCanvasElement | null>(null);
  let chartInstance: Chart | null = null;

  const options: ChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        // beginAtZero: true,
        ticks: {
          maxTicksLimit: 5, // stepSize: 10, // Set the desired step size here (1 means show every label, 2 means show every other label, and so on)
        },
        grid: {
          color: '#4B4B4B', // borderDash: [3, 3], // Creates a dotted line for grid lines
        },
        border: {
          dash: [10, 10],
        },
      },
      x: {
        ticks: {
          maxTicksLimit: 5, // Set the desired step size here (1 means show every label, 2 means show every other label, and so on)
        },
        display: true,
        grid: {
          display: false, // Hide vertical grid lines on the x-axis
        },
      },
    },
    layout: {
      padding: {
        left: 40,
        right: 40,
        top: 48,
      },
    },
    plugins: {
      legend: {
        display: false,
      },

      tooltip: {
        // mode: 'index', // Show tooltip based on dataset index
        // intersect: false, // Prevent hiding tooltip when hovering between points
        mode: 'nearest', // Show tooltip for the nearest point on the curve
        intersect: false, // Prevent hiding tooltip when hovering between points
        callbacks: {
          title: () => 'test', // Disable title (optional)
          label: context => `Value: ${context.parsed.y}`, // Show the y-axis value in the tooltip
        },
      },
    },
  };

  useEffect(() => {
    const sampleData = [
      [1662163200000, 1.0900239992770355],
      [1662249600000, 1.0701311836740102],
      [1662336000000, 1.089026098295698],
      [1662422400000, 1.146690696440332],
      [1662508800000, 1.0374171583050045],
      [1662595200000, 1.1672488665693102],
      [1662681600000, 1.1287878038838643],
      [1662768000000, 1.2039742060179208],
      [1662854400000, 1.2459976374503754],
      [1662940800000, 1.1806284717032889],
      [1663027200000, 1.1381865687965693],
      [1663113600000, 1.0542364389647438],
      [1663200000000, 1.0713871984658825],
      [1663286400000, 1.0503067274688105],
      [1663372800000, 1.0525413282780722],
      [1663459200000, 1.0825181721654875],
      [1663545600000, 0.9433633391750335],
      [1663632000000, 0.9839690442015888],
      [1663718400000, 0.9448793140798516],
      [1663804800000, 0.8622589049340205],
      [1663891200000, 0.9179976099498147],
      [1663977600000, 0.9445858612137462],
      [1664064000000, 0.9199070570832861],
      [1664150400000, 0.8908014140741003],
      [1664236800000, 0.9280684734040128],
      [1664323200000, 0.9161312396651193],
      [1664409600000, 0.9402463345172122],
      [1664496000000, 0.9273261645377933],
      [1664582400000, 0.9170830523506136],
      [1664668800000, 0.8931984998579603],
      [1664755200000, 0.8605505883797584],
      [1664841600000, 0.8987557324836007],
      [1664928000000, 0.9128251331093097],
      [1665014400000, 0.9048175501885745],
      [1665100800000, 0.8904785793124375],
      [1665187200000, 0.8852681852340661],
      [1665273600000, 0.8822886676901122],
      [1665360000000, 0.8824468401519048],
      [1665446400000, 0.8533358914578352],
      [1665532800000, 0.8183560276876826],
      [1665619200000, 0.8217739463756492],
      [1665705600000, 0.8018055840973792],
      [1665792000000, 0.8128539209796022],
      [1665878400000, 0.8063474657286165],
      [1665964800000, 0.8170042768798393],
      [1666051200000, 0.8904864702943357],
      [1666137600000, 0.9122908604288027],
      [1666224000000, 0.8509894377175433],
      [1666310400000, 0.8486356977541542],
      [1666396800000, 0.8940984357043132],
      [1666483200000, 0.8778586558137952],
      [1666569600000, 0.9202476410429646],
      [1666656000000, 0.8756753937491291],
      [1666742400000, 0.9122469322510046],
      [1666828800000, 0.9350209698777256],
      [1666915200000, 0.9122534400317318],
      [1667001600000, 0.9448467217502525],
      [1667088000000, 0.9328057887640552],
      [1667174400000, 0.9074898350351109],
      [1667260800000, 0.8848881418975849],
      [1667347200000, 0.8923491672900037],
      [1667433600000, 0.8647832362367626],
      [1667520000000, 0.9012267544303151],
      [1667606400000, 1.0233623153167908],
      [1667692800000, 0.9961788103676384],
      [1667779200000, 0.952751072193428],
      [1667865600000, 1.0046244029977625],
      [1667952000000, 0.770906166296589],
      [1668038400000, 0.549023912802821],
      [1668124800000, 0.6892103492313992],
      [1668211200000, 0.664987704096063],
      [1668297600000, 0.6023444001895017],
      [1668384000000, 0.6320981901067064],
      [1668470400000, 0.6087873980249885],
      [1668556800000, 0.6061305101778959],
      [1668643200000, 0.587951676309444],
      [1668729600000, 0.5529522241516798],
      [1668816000000, 0.5571659266955356],
      [1668902400000, 0.5429323176770796],
      [1668988800000, 0.512043621060429],
      [1669075200000, 0.5015155898195756],
      [1669161600000, 0.6339276587444539],
      [1669248000000, 0.6880655068805942],
      [1669334400000, 0.6896963697278328],
      [1669420800000, 0.6801110225801213],
      [1669507200000, 0.702298462085164],
      [1669593600000, 0.6845394149897881],
      [1669680000000, 0.64560445978591],
      [1669766400000, 0.6622258450993321],
      [1669852800000, 0.6729753959060218],
      [1669939200000, 0.6397570172334298],
      [1670025600000, 0.6577743244312875],
      [1670112000000, 0.6363283430876604],
      [1670198400000, 0.6713335207036049],
      [1670284800000, 0.6750013587238317],
      [1670371200000, 0.680087548173825],
      [1670457600000, 0.6532217628010517],
      [1670544000000, 0.6692233676968194],
      [1670630400000, 0.6454529906654746],
      [1670716800000, 0.6395700394232129],
      [1670803200000, 0.6313121159611998],
      [1670889600000, 0.6187124692776448],
      [1670976000000, 0.65369767464436],
      [1671062400000, 0.6485023193576787],
      [1671148800000, 0.6160369802089937],
      [1671235200000, 0.5438129125261588],
      [1671321600000, 0.5613887436638518],
      [1671408000000, 0.5497039225529157],
      [1671494400000, 0.5166795787193001],
      [1671580800000, 0.5302344811010443],
      [1671667200000, 0.5166096199513901],
      [1671753600000, 0.526239790075817],
      [1671840000000, 0.5272244028876165],
      [1671926400000, 0.52637427806402],
      [1672012800000, 0.5230171641117556],
      [1672099200000, 0.5376156810505027],
      [1672185600000, 0.5293788186348518],
      [1672272000000, 0.5107585965493422],
      [1672358400000, 0.5126395564054852],
      [1672444800000, 0.5296309285492592],
      [1672531200000, 0.5248733850584922],
      [1672617600000, 0.5290587071999457],
      [1672704000000, 0.534884795496824],
      [1672790400000, 0.5320680782314922],
      [1672876800000, 0.5556343582105548],
      [1672963200000, 0.5453207228752252],
      [1673049600000, 0.5457375397352509],
      [1673136000000, 0.5533981882997725],
      [1673222400000, 0.5724254654221999],
      [1673308800000, 0.643738574719494],
      [1673395200000, 0.6525352026073621],
      [1673481600000, 0.6701141486604406],
      [1673568000000, 0.6888086784954673],
      [1673654400000, 0.8023678062957068],
      [1673740800000, 0.8174963419319745],
      [1673827200000, 0.832245726781101],
      [1673913600000, 0.8650178434956106],
      [1674000000000, 0.9159455347363934],
      [1674086400000, 0.9007739563319258],
      [1674172800000, 0.899896583783035],
      [1674259200000, 1.0346306785652404],
      [1674345600000, 0.9963849264613259],
      [1674432000000, 1.0757600079180072],
      [1674518400000, 1.0683824463521523],
      [1674604800000, 0.9922832113667368],
      [1674691200000, 1.0339713324987478],
      [1674777600000, 1.047913803639982],
      [1674864000000, 1.1337798722952799],
      [1674950400000, 1.0708273638611214],
      [1675036800000, 1.093064125483192],
      [1675123200000, 0.9927822667530778],
      [1675209600000, 1.0191742342702093],
      [1675296000000, 1.1125690110507884],
      [1675382400000, 1.062919297840361],
      [1675468800000, 1.1147058877850575],
      [1675555200000, 1.1109509666084423],
      [1675641600000, 1.0506770634028246],
      [1675728000000, 1.0462663805931594],
      [1675814400000, 1.0931811659654422],
      [1675900800000, 1.139869645429652],
      [1675987200000, 0.9703273764163598],
      [1676073600000, 0.9599650853926815],
      [1676160000000, 0.9591291600707746],
      [1676246400000, 0.9257729688491815],
      [1676332800000, 1.057155464704583],
      [1676419200000, 1.0808994786652808],
      [1676505600000, 1.147537237268035],
      [1676592000000, 1.1011690730660872],
      [1676678400000, 1.2182010403677586],
      [1676764800000, 1.2556728450447467],
      [1676851200000, 1.201117538837397],
      [1676937600000, 1.26335239201028],
      [1677024000000, 1.1602540966646249],
      [1677110400000, 1.1061107479521957],
      [1677196800000, 1.0818625698811672],
      [1677283200000, 0.9991882674951247],
      [1677369600000, 0.9871160380522964],
      [1677456000000, 1.0188060770753165],
      [1677542400000, 1.015549159262772],
      [1677628800000, 0.9935526448233196],
      [1677715200000, 1.0348219466929294],
      [1677801600000, 0.9918046746699937],
      [1677888000000, 0.9341064530530382],
      [1677974400000, 0.9092943544687697],
      [1678060800000, 0.9296692406769428],
      [1678147200000, 0.9499945611419847],
      [1678233600000, 0.9742077344768095],
      [1678320000000, 0.8874742416953587],
      [1678406400000, 0.8399674362115561],
      [1678492800000, 0.8851798598575578],
      [1678579200000, 0.8588419467787674],
      [1678665600000, 0.9360482532388495],
      [1678752000000, 0.9783916755305521],
      [1678838400000, 0.9915725766765566],
      [1678924800000, 0.8932918990442689],
      [1679011200000, 0.9169982806089739],
      [1679097600000, 1.0060579993256762],
      [1679184000000, 0.9917115879292622],
      [1679270400000, 1.0298063963376296],
      [1679356800000, 0.9699109800952912],
      [1679443200000, 1.0026431054097817],
      [1679529600000, 0.9475027867297375],
      [1679616000000, 0.9729269780336189],
      [1679702400000, 0.9081898049629162],
      [1679788800000, 0.9227001290987534],
      [1679875200000, 0.934557718648989],
      [1679961600000, 0.8910088215370698],
      [1680048000000, 0.9213955323550294],
      [1680134400000, 0.9417771576434295],
      [1680220800000, 0.9209766952445861],
      [1680307200000, 0.935895078986602],
      [1680393600000, 0.9268020799568332],
      [1680480000000, 0.9079433660842119],
      [1680566400000, 0.9214818488779954],
      [1680652800000, 0.9966662198854701],
      [1680739200000, 1.0031943223631274],
      [1680825600000, 1.0105130275769796],
      [1680912000000, 1.0204528355492937],
      [1680998400000, 1.025092692320633],
      [1681084800000, 1.0127717496792408],
      [1681171200000, 1.0277453071415867],
      [1681257600000, 1.0202580881096002],
      [1681344000000, 1.0305521708646728],
      [1681430400000, 1.066804781616423],
      [1681516800000, 1.091763558304257],
      [1681603200000, 1.0909719395563258],
      [1681689600000, 1.104277832482393],
      [1681776000000, 1.0505777326129997],
      [1681862400000, 1.0746982542030554],
      [1681948800000, 0.9553980147900103],
      [1682035200000, 0.9458376208631628],
      [1682121600000, 0.9212711179546766],
      [1682208000000, 0.9378624594830969],
      [1682294400000, 0.9461895730543832],
      [1682380800000, 0.926440551403302],
      [1682467200000, 0.9408347202137952],
      [1682553600000, 0.9184839447378003],
      [1682640000000, 0.9453295009649642],
      [1682726400000, 0.9252985509583264],
      [1682812800000, 0.9345973931226796],
      [1682899200000, 0.9115892977828853],
      [1682985600000, 0.8844319051182389],
      [1683072000000, 0.9047853511924472],
      [1683158400000, 0.9722301821231759],
      [1683244800000, 0.9284618421520836],
      [1683331200000, 0.9546138495960825],
      [1683417600000, 0.904653685349023],
      [1683504000000, 0.8924192044494521],
      [1683590400000, 0.8338713967703758],
      [1683676800000, 0.8362458428019466],
      [1683763200000, 0.8424224599508976],
      [1683849600000, 0.8007770373909242],
      [1683936000000, 0.8159923863152817],
      [1684022400000, 0.8032927694944141],
      [1684108800000, 0.8095439038002032],
      [1684195200000, 0.8286027793128199],
      [1684281600000, 0.8342011237210952],
      [1684368000000, 0.8362142995036498],
      [1684454400000, 0.8266920544501645],
      [1684540800000, 0.8281602320531972],
      [1684627200000, 0.8353214959805793],
      [1684713600000, 0.8367029668195752],
      [1684800000000, 0.8494239777684899],
      [1684886400000, 0.863982867348035],
      [1684972800000, 0.8305228276744028],
      [1685059200000, 0.8264900804988418],
      [1685145600000, 0.8570843032918685],
      [1685232000000, 0.8551151549136822],
      [1685318400000, 0.8633372118365117],
      [1685404800000, 0.8542795664191526],
      [1685491200000, 0.8398253310380276],
      [1685577600000, 0.8221047380404504],
      [1685664000000, 0.8126393757289834],
      [1685750400000, 0.8525504394278677],
      [1685836800000, 0.849369857262433],
      [1685923200000, 0.8490157769099117],
      [1686009600000, 0.7799872830981793],
      [1686096000000, 0.8003356640730144],
      [1686182400000, 0.7578483510010249],
      [1686268800000, 0.7592876893057452],
      [1686355200000, 0.756117779711733],
      [1686441600000, 0.6720293893139933],
      [1686528000000, 0.668016986847902],
      [1686614400000, 0.6358564389618088],
      [1686700800000, 0.6476400082481663],
      [1686787200000, 0.5705036895858729],
      [1686873600000, 0.6067431031757115],
      [1686960000000, 0.621999361348436],
      [1687046400000, 0.6195386367002357],
      [1687132800000, 0.6231445331024681],
      [1687219200000, 0.629939778390795],
      [1687305600000, 0.6636601482039971],
      [1687392000000, 0.688862654770788],
      [1687478400000, 0.6690167369299891],
      [1687564800000, 0.6908039546394684],
      [1687651200000, 0.6700981355157715],
      [1687737600000, 0.7033655880300831],
      [1687824000000, 0.6787306713594954],
      [1687910400000, 0.6926630785425252],
      [1687996800000, 0.6608451625707646],
      [1688083200000, 0.7111591467201147],
      [1688169600000, 0.7614792711370806],
      [1688256000000, 0.777939530880651],
      [1688342400000, 0.7626652519619012],
      [1688428800000, 0.7827507426248462],
      [1688515200000, 0.8073716561921016],
      [1688601600000, 0.7818281380894334],
      [1688688000000, 0.7290533517079388],
      [1688774400000, 0.7886450956600537],
      [1688860800000, 0.7788021372342454],
      [1688947200000, 0.7976923452825925],
      [1689033600000, 0.8075059911014384],
      [1689120000000, 0.7936361093515217],
      [1689206400000, 0.7852161186563607],
      [1689292800000, 0.8447382209959161],
      [1689379200000, 0.8205004485681487],
      [1689465600000, 0.8208080827329769],
      [1689552000000, 0.8100635146608511],
      [1689638400000, 0.8090939792226827],
      [1689724800000, 0.783897477538426],
      [1689811200000, 0.7785473162964891],
      [1689897600000, 0.7850457445443835],
      [1689984000000, 0.7693269574784298],
      [1690070400000, 0.751336514776419],
      [1690156800000, 0.7582761327664581],
      [1690243200000, 0.7283625888647821],
      [1690329600000, 0.7263251565305631],
      [1690416000000, 0.7301358897953288],
      [1690502400000, 0.7282892084191497],
      [1690588800000, 0.7293844644990558],
      [1690675200000, 0.7375410522125445],
      [1690761600000, 0.6238500400749354],
      [1690848000000, 0.569820560871395],
      [1690934400000, 0.6129262400946437],
      [1691020800000, 0.5817471606263881],
      [1691107200000, 0.580850035208786],
      [1691193600000, 0.6125806756538932],
      [1691280000000, 0.6212199839491618],
      [1691366400000, 0.610557731579564],
      [1691452800000, 0.6129698111547981],
      [1691539200000, 0.6003192543956526],
      [1691625600000, 0.615041312928526],
      [1691712000000, 0.6076029002683676],
      [1691798400000, 0.5951607920517779],
      [1691884800000, 0.5836567481551632],
      [1691971200000, 0.5769743538186831],
      [1692057600000, 0.5803918911990197],
      [1692144000000, 0.5562083090545265],
      [1692230400000, 0.5417730549550167],
      [1692316800000, 0.49280382083039254],
      [1692403200000, 0.49483353718459894],
      [1692489600000, 0.5030768582034479],
      [1692576000000, 0.49838749774328506],
      [1692662400000, 0.47854272523516755],
      [1692748800000, 0.4736956256985752],
      [1692835200000, 0.4678479224658855],
      [1692921600000, 0.4537407524271191],
      [1693008000000, 0.45428552796785787],
      [1693094400000, 0.45223709393560696],
      [1693180800000, 0.4594077459442351],
      [1693267200000, 0.48707800470587514],
      [1693353600000, 0.4828708965375636],
      [1693440000000, 0.4723261041809121],
      [1693526400000, 0.4523886296088037],
      [1693614229000, 0.4382558835015522],
    ];
    const timestamps = [];
    const pricess = [];
    for (const item of sampleData) {
      const [timestamp, price] = item;
      timestamps.push(formatDate(timestamp, 'MMM d'));
      pricess.push(price);
    }
    if (chartRef.current) {
      if (chartInstance) {
        chartInstance.destroy(); // Destroy previous chart instance if it exists
      }

      chartInstance = new Chart(chartRef.current, {
        type: 'line',
        data: {
          labels: timestamps,
          datasets: [
            {
              data: pricess, // generateRandomDataArray(5,0,10),// [0 , 22.74, 15.56, 13.48, 18.62, 22.71, ],
              borderColor: 'rgb(214, 0, 249)',
              tension: 1,
              fill: true,
              pointRadius: 0,
              hoverRadius: 1,
              backgroundColor: (context: any) => {
                // Custom gradient logic
                const { chart } = context;
                const { ctx } = chart;
                const gradient = ctx.createLinearGradient(
                  0,
                  0,
                  0,
                  chart.height,
                );
                gradient.addColorStop(0, 'rgba(214, 0, 249, 0.6)'); // Start color (opacity 0.8)
                gradient.addColorStop(1, 'rgba(214, 0, 249, 0)'); // End color (opacity 0)
                return gradient;
              },
            },
          ],
        },
        options,
      });
    }
    return () => {
      if (chartInstance) {
        chartInstance.destroy(); // Clean up the chart instance when the component unmounts
      }
    };
  }, []);

  return (
    <Container height={300} position="relative" width="full">
      <Container
        position="absolute"
        top={0}
        left={0}
        width="full"
        height="full"
      >
        <canvas ref={chartRef} />
      </Container>
    </Container>
  );
};
